#!/bin/bash

TPM_DIR="$HOME/.tmux/plugins/tpm"
VUNDLE_DIR="$HOME/.vim/bundle/Vundle.vim"
ALFRED_DIR="$HOME/src/alfred"

quiet_git() {
    stdout=$(mktemp)
    stderr=$(mktemp)
    
    if ! git "$@" </dev/null >$stdout 2>$stderr; then
        cat $stderr >&2
        rm -f $stdout $stderr
        exit 1
    fi
    
    rm -f $stdout $stderr
}

if [[ "$(uname)" == 'Darwin' ]]; then
		if ! type -P brew >/dev/null; then
    	CI=1 /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
		fi
    brew analytics off
    brew bundle

	if [[ -d "$ALFRED_DIR" ]]; then
		git -C "$ALFRED_DIR" pull
	else
		quiet_git clone git@github.com:nodeselector/alfred.git "$ALFRED_DIR"
	fi
fi

# TPM
if [[ -d "$TPM_DIR" ]]; then
	git -C "$TPM_DIR" pull
else
	quiet_git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm
fi

# Vundle
if [[ -d "$VUNDLE_DIR" ]]; then
	git -C "$VUNDLE_DIR" pull
else
	quiet_git clone https://github.com/VundleVim/Vundle.vim.git "$VUNDLE_DIR"
fi
