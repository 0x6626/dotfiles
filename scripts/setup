#!/bin/bash

DOTFILES_DIR=~/src/dotfiles

quiet_git() {
    stdout=$(mktemp)
    stderr=$(mktemp)
    
    if ! git "$@" </dev/null >"$stdout" 2>"$stderr"; then
        cat "$stderr" >&2
        rm -f "$stdout" "$stderr"
        exit 1
    fi
    
    rm -f "$stdout" "$stderr"
}


if $RESET; then
	rm -rf ~/.zsh
	rm -f ~/.zshrc
	rm -rf ~/.tmux
	rm -f ~/.tmux.conf
	rm -rf ~/.vim/bundle
	rm -rf "$HOME/src/alfred"
fi

source "$DOTFILES_DIR/scripts/bootstrap"

if ! [ "$SHELL" == "/bin/zsh"  ]; then
    sudo chsh -s /bin/zsh "$USER"
fi

#########
# common
#########

stow --dir="$DOTFILES_DIR" --target="$HOME" zsh
stow --dir="$DOTFILES_DIR" --target="$HOME" tmux
tmux start-server
tmux source ~/.tmux.conf

stow --dir="$DOTFILES_DIR" --target="$HOME" vim
vim +BundleInstall +qall

#########
# macos
#########

if [[ "$(uname)" == 'Darwin' ]]; then
	"$DOTFILES_DIR/.macos"
fi
